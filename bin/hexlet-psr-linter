#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use Colors\Color;

use function \HexletPsrLinter\lint;
use function \HexletPsrLinter\Utils\formatErrorMessage;
use function \HexletPsrLinter\Utils\getFilesByPath;

try {
    $exitCode = 0;

    $cmd = new \Commando\Command();
    $cmd->doNotTrapErrors();
    $cmd->argument()
        ->title('<path>')
        ->describedAs('A file or folder to lint.')
        ->require();

    $args = $cmd->getArgumentValues();
    $path = $args[0];

    $files = getFilesByPath($path);
    foreach ($files as $file) {
        echo (new Color(realpath($file)))->white->underline.PHP_EOL;
        $fileContent = file_get_contents($file);
        $report = lint($fileContent);
        echo $report->getOutput();
        if ($report->getErrors() > 0) {
            $exitCode = 1;
        }
    }

    exit($exitCode);
} catch (Throwable $e) {
    //echo get_class($e).PHP_EOL;
    echo formatErrorMessage($e->getMessage());
    return 1;
}
